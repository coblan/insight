{% extends "index.html" %}
{% load static %}
{% load jsonify %}

{% block page_content %}
<script src='{% static "js/fields.pack.js" %}'></script>
<script src='{% static "js/table.pack.js" %}'></script>
<script type="text/javascript">
	
	filters={{filters | jsonify }}
	q='{{q | safe |default:""}}'
	placeholder = '{{placeholder |default:""}}'
	sort={{sort | jsonify }}
	heads={{ heads | jsonify }}
	rows={{ rows | jsonify }}
	page_nums = {{ page_nums | jsonify}}


	$(function () {
		new Vue({
			el:'#there',
			data:{
		        heads:heads,
		        rows:rows,
		        crt_page:{},
		        filters:filters,
		        sort:sort,
		        page_nums:page_nums,
		        q:q,
		        placeholder:placeholder,
		        selected:[],
		        del_info:[],
		        menu:menu,
			},
			mixins:[build_table_args],
			methods:{
				map:function (name,row) {
					if(name==heads[0].name){
			                return '<a href="edit/'+row.pk+'?next='+btoa(location.pathname+location.search)+'">'+row[name]+'</a>'
		                }else{
			                return row[name]
			        }
				},
				add_new:function () {
					//location='{% url "model" "basicinfo/edit/" %}'
					location='edit/?next='+btoa(location.pathname+location.search)
				},
				del_item:function () {
					
					if (this.selected.length==0){
						return
					}
					var rows=[]
					var inst_ls =[]
					for(var j=0;j<this.selected.length;j++){
						var pk = this.selected[j]
						for(var i=0;i<this.rows.length;i++){
							if(this.rows[i].pk.toString()==pk){
								rows.push(this.rows[i])
								inst_ls.push({pk:pk,_class:this.rows[i]._class})
							}
						}
					}
					
					location="{% url "model" "del_rows" %}?rows="+btoa(JSON.stringify(inst_ls))+'&next='+btoa(location.pathname+location.search)
				}
			}
			
		})
	})
</script>
<div id='there'>
	<div class='btn-panel'>
		
		<path-nav :menu='menu'></path-nav>
		
		<form class='button-group' autocomplete="on" v-if='placeholder || filters.length>0'>
			<input v-if='placeholder' type="text" name="_q" v-model='q' :placeholder='placeholder' class='form-control'/>
			<select name="" id="" v-for='filter in filters' v-model='filter.value' class='form-control'>
			        <option value="" v-text='filter.label'></option>
			        <option value="" >----</option>
			        <option  v-for='option in filter.options' :value="option.name" v-text='option.label'></option>
			</select>
			<button name="go" type="button" class="btn btn-info" @click='search()' style='position: absolute;right:-80px;top:-1px;width:70px;height:33px;'>提交</button>
			<!--<input type="submit">-->
		</form>
		<div class='btn-group' style='float: right;'>
			<button type="button" class="btn btn-success" @click='add_new()' >创建</button>
			<button type="button" class="btn btn-danger" @click='del_item()' >删除</button>
		</div>
		
	</div>
	
	
	

	<sort-table class='table suit-style' :heads='heads' :rows='rows' :sort='sort' :map='map' :selected='selected'></sort-table>
	<paginator :nums='page_nums'></paginator>
	

	<!--<del-info :infos='del_info'></del-info>-->
	
	
</div>
<style type="text/css" media="screen" id="test">
	.button-group{
		position: relative;
		display: inline-block;
	}
	.form-control{
		display: inline-block;
		margin-left:10px;
		width:auto;
		height:30px;
	}
</style>
<!--<script type="text/javascript">
	Vue.component('del-info',{
		template:'#del-info',
		props:['infos'],
	})
</script>
<template id='del-info'>
	<div>
		<div v-for='info in infos'>
			<h3 v-text='$key'></h3>
			<ul>
				<li v-for='item in info'>
					<span v-text='item.str'></span>
				</li>
			</ul>
		</div>
		
	</div>
	
</template>-->
{% endblock %}